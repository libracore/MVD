<!DOCTYPE html>
<!-- Built on Frappe. https://frappe.io/ -->
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="generator" content="frappe">

        {% block meta_block %}
            {% include "templates/includes/meta_block.html" %}
        {% endblock %}

        <title>{% block title %} {{ title | striptags }} {% endblock %}</title>

        {% block favicon %}
        <link
            rel="shortcut icon"
            href="{{ (favicon or "/assets/frappe/images/favicon.png") | abs_url }}"
            type="image/x-icon"
        >
        {% endblock %}
        <script>
            window.frappe = {};
            frappe.ready_events = [];
            frappe.ready = function(fn) {
                frappe.ready_events.push(fn);
            }
            window.dev_server = {{ dev_server }};
            window.socketio_port = {{ frappe.socketio_port }};
        </script>
    </head>
    <body frappe-session-status="{{ 'logged-in' if frappe.session.user != 'Guest' else 'logged-out'}}" data-path="{{ path | e }}" id="home" class="smvForm smvEmailBeratungForm isCookieRequired process-page">
        <div class="content-wrapper" id="content">
            <header class="header" role="heading">
                <div class="branding">
                    <div class="container-inner" role="banner">
                        <ul class="skip">
                            <li><a href="/mv.html" accesskey="0" title="[ALT + 0]">Startseite</a></li>
                            <li><a href="#nav-global" accesskey="1" title="[ALT + 1]">Hauptmenü</a></li>
                            <li><a href="#main" accesskey="2" title="[ALT + 2]">Hauptinhalt</a></li>
                            <li><a href="/mv/mitgliedschaft-verband/kontakt.html" accesskey="3" title="[ALT + 3]">Kontakt</a></li>
                            <li><a href="#section" accesskey="3" title="[ALT + 4]">Sektionswahl</a></li>
                            <li><a href="/mv/searchresults.html#newsearch" accesskey="5" title="[ALT + 5]">Suche</a></li>
                            <li><a href="#extras" accesskey="6" title="[ALT + 6]">Extrainhalte</a></li>
                            <li><a href="#nav" accesskey="7" title="[ALT + 7]">Untermenü</a></li>
                            <li><a href="#site-info-box" accesskey="8" title="[ALT + 8]">Fusszeile</a></li>
                        </ul>
                        <div class="row">
                            <div class="col-sm-9 col-md-4 col-lg-3">
                                <div class="logo">
                                    <a class="link-home" href="https://mieterverband.ch/mv.html" title="Startseite">
                                        <img class="h-flex" src="/assets/mvd/img/mvs_nationales_logo_klein.png" alt="MV Mieterinnen- und Mieterverband">
                                        <strong class="h-vh">MV</strong>
                                    </a>
                                </div>
                            </div>
                            <div class="col-sm-3 col-md-8 col-lg-6">
                                <nav class="nav-main " role="navigation">
                                    <h6 class="h-vh">Navigation</h6>
                                    <a href="#" class="nav-handle" aria-hidden="true" title="Navigation Anzeigen"><span></span></a>
                                    <ul class="nav-list h-cf">
                                        <li class="nav-item " data-url="https://mieterverband.ch/mv/mietrecht-beratung.html">
                                            <a class="nav-link" href="https://mieterverband.ch/mv/mietrecht-beratung.html">
                                                <span>Mietrecht &amp;<br>Beratung</span>
                                            </a>
                                        </li>
                                        <li class="nav-item " data-url="https://mieterverband.ch/mv/mitgliedschaft-verband.html">
                                            <a class="nav-link" href="https://mieterverband.ch/mv/mitgliedschaft-verband.html">
                                                <span>Mitgliedschaft &amp;<br>Verband</span>
                                            </a>
                                        </li>
                                        <li class="nav-item " data-url="https://mieterverband.ch/mv/politik-positionen.html">
                                            <a class="nav-link" href="https://mieterverband.ch/mv/politik-positionen.html">
                                                <span>Politik &amp;<br>Positionen</span>
                                            </a>
                                        </li>
                                    </ul>
                                </nav>
                            </div>
                            <div class="col-sm-12 col-md-8 col-lg-3">
                                <nav class="nav-meta h-cf">
                                    <div class="top-row h-cf">
                                        <a href="https://mieterverband.ch/mv.html" class="link-home" title="Home">
                                            <i class="fa fa-home"></i><span class="h-th">Home</span>
                                        </a>
                                        <a href="https://mieterverband.ch/mv/mitgliedschaft-verband/kontakt.html" class="link-contact">Kontakt</a>
                                        <form id="smv-search-form" class="search-form js-search-form" action="https://mieterverband.ch/mv/searchresults.html">
                                            <input required="required" id="searchbar" class="search-field" name="queryStr" placeholder="Suche im Ratgeber Mietrecht" type="text" value="">
                                            <span id="smv-search-span" class="fa fa-search"></span>
                                        </form>
                                        <span class="selected-language">
                                            {{ language }} 
                                        </span>
                                    </div>
                                    <div class="bottom-row">
                                        
                                        <!-- end nav-meta -->
                                    </div>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="branding-2">
                    <div class="container-inner">
                        <div class="row">
                            <div class="col-sm-12 col-md-12 col-lg-12">
                                <div class="logo-section">
                                    <a class="section-title" href="https://mieterverband.ch/{{ sektion_web }}.html" title="Startseite">
                                       {{ _("Ihre digitale Rechnung", language) }}
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            <div class="print-header" aria-hidden="true">
                <div class="row">
                    <div class="col-sm-12 col-md-12 col-lg-12">
                        <div class="logo">
                            <img class="h-flex" src="/assets/mvd/img/mvs_nationales_logo_klein.png" alt="MV">
                        </div>
                    </div>
                </div>
            </div>
            <div class="background-wrapper section">
                <div class="container-inner">
                    <div class="breadcrumb"></div>
                </div>
                <section class="stage"></section>
                <div class="content container-inner">
                    <div class="row">
                        <div class="col-sm-12 col-md-12 col-lg-8">
                            <main role="main" class="">
                                <div class="form js-form">
                                    <!--<div class="form-intro">
                                        <h1 class="e-h1 form-title">Digitalrechnung</h1>
                                    </div>-->
                                    <!-- Hinweis Beratungsformular und Adressänderungen -->
                                    {% if hash_check == 'bestätigung' %}
                                    <div class="text-image text-image-mv rich-text highlight no-img">
                                        <h2>
                                           {{ _("Besten Dank für Ihre Anmeldung zur digitalen Jahresrechnung", language) }}</h2>
                                        <p>{{ _("Die Umstellung gilt ab nächstem Jahr. Bitte begleichen Sie den aktuellen Jahresbeitrag mit der Ihnen vorliegenden Rechnung.", language) }}</p>
                                        <p>{{ _("Danke, dass Sie helfen Ressourcen zu schonen.", language) }}</p>

                                        
                                        <p>{{ _("Anmeldung unabsichtlich? klicken Sie unten", language) }} <a href="#" onclick="opt_out('{{ digitalrechnung }}');">«{{ _("Abbrechen: Rechnung per Post", language) }}».</a></a></p>

                                            
                                    </div>
                                    {% endif %}
                                    {% if hash_check == 'show opt out bestätigung' %}
                                    <div class="text-image text-image-mv rich-text highlight no-img">
                                        <p>{{ _("Sie haben sich für die Rechnung auf Papier per Post entschieden.", language) }}</p>
                                    </div>
                                    {% endif %}
                                    {% if hash_check == 'add mail' %}
                                    <div class="text-image text-image-mv rich-text highlight no-img">
                                        <p>{{ _("Wir haben leider keine E-Mail Adresse von Ihnen.", language) }}<br>{{ _("Für die Umstellung auf die digitale Rechnung erfassen Sie bitte unten Ihre E-Mail-Adresse.", language) }}</p>
                                        {%if language == 'fr' %}
                                        <p>En indiquant votre adresse e-mail, vous acceptez que nous l'utilisions pour la correspondance conformément aux  <a href="https://www.mieterverband.ch/dam/jcr:63a2ae49-4875-4cd3-b3b7-55158f8c1856/Statuten%202019%20f.pdf"  target="_blank">statuts de l'association</a> et à la <a href="https://www.mieterverband.ch/mv/mitgliedschaft-verband/datenschutz.html" target="_blank">déclaration de protection des données</a>.</p>
                                        {% else %}
                                        <p>Mit der Angabe Ihrer E-Mail-Adresse erklären Sie sich einverstanden, dass wir diese für die Korrespondenz gemäss den <a href="https://www.mieterverband.ch/{{ sektion_web }}/mitgliedschaft/statuten-reglemente.html"  target="_blank">Statuten</a> und der <a href="https://www.mieterverband.ch/mv/mitgliedschaft-verband/datenschutz.html" target="_blank">Datenschutzerklärung</a> verwenden.</p>
                                        {% endif %}
                                    </div>
                                    {% endif %}
                                    {% if hash_check == 'show opt out' %}
                                    <div class="text-image text-image-mv rich-text highlight no-img">
                                        <p>{{ _("Wir senden Ihnen die Rechnung 2026 per E-Mail an:", language) }} <br> {{ email }} </p>
                                    </div>
                                    {% endif %}
                                    {% if hash_check == 'unknown_error' %}
                                    <div class="text-image text-image-mv rich-text highlight no-img">
                                        <p>Ein unbekannter Fehler ist aufgetreten. Bitte kontaktieren Sie den Mieterinnen- und Mieterverband: <a href="mailto:info@mieterverband.ch?subject=Fehler Digitale Rechnung&body=Guten%20Tag%0A%0ADie%20Umstellung%20von%20Papierrechnung%20zu%20PDF%20per%20E-Mail%20war%20%C3%BCber%20die%20Website%20nicht%20m%C3%B6glich.%20Bitte%20%C3%A4ndern%20Sie%20dies%20f%C3%BCr%20folgende%20Mitgliedschaft%3A%0A%0AMitgliedernummer%3A%20MV%0AName%20und%20Vorname%3A%0A%0A">info@mieterverband.ch</a></a></p>
                                    </div>
                                    {% endif %}
                                    <div class="form-wrapper">
                                        <form id="form0" method="post" action="" onsubmit=";" enctype="multipart/form-data">
                                            <fieldset class="fieldset">
                                                {% if hash_check != 'unknown_error' %}
                                                <span class="e-copy-small required-hint position-right"><span>*</span> {{ _("Pflichtfeld", language) }}</span>
                                                <h2 class="e-h3 fieldset-title">{{ _("Ihre Angaben", language) }}</h2>
                                                <div class="form-row" {% if hash_check == 'show opt out bestätigung' %} style="display: none;" {% endif%}>
                                                    <div class="row">
                                                        <div class="col-sm-12 col-md-4 col-lg-4">
                                                            <label for="email" class="label email required">
                                                                {{ _("E-Mail-Adresse", language) }}&nbsp;*
                                                            </label>
                                                        </div>
                                                        <div class="col-sm-12 col-md-8 col-lg-8">
                                                            <input type="email" name="email" id="email" value="{{ email }}" maxlength="50" required>
                                                            <span class="hint" id="emailHint">{{ _("Bitte ändern, falls nicht mehr aktuell.", language) }}</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="form-row">
                                                    <div class="row readonly">
                                                        <div class="col-sm-12 col-md-4 col-lg-4">
                                                            <label for="aktiviertam" class="label mitgliedschaft_nr">
                                                                {{ _("Aktiviert am", language) }}
                                                            </label>
                                                            <label for="deaktiviertam" class="label mitgliedschaft_nr">
                                                                {{ _("Deaktiviert am", language) }}
                                                            </label>
                                                        </div>
                                                        <div class="col-sm-12 col-md-8 col-lg-8">
                                                            <p class="value-read-only">{{ opt_in }}</p>
                                                            <p class="value-read-only">{{ opt_out }}</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                {% if hash_check == 'bestätigung' %}
                                                <div class="button-wrapper">
                                                    <input type="button" style="background-color: #6689a1;" value="{{ _("Abbrechen: Rechnung per Post", language) }}" onclick="opt_out('{{ digitalrechnung }}');">
                                                    <input type="button" id="changeEmailButton" style="background-color: #003a62; ;display:none;" value="E-Mail-Adresse anpassen" onclick="change_email('{{ digitalrechnung }}');" disabled>
                                                    <input type="button" value="OK"  onclick="location.reload();">

                                                </div>
                                                {% endif %}
                                                {% if hash_check == 'add mail' %}
                                                <div class="button-wrapper">
                                                    <input type="button" id="addEmailButton" style="background-color: #6689a1;display" value="{{ _("E-Mail-Adresse hinzufügen", language) }}" onclick="change_email('{{ digitalrechnung }}');" disabled>
                                                </div>
                                                {% endif %}
                                                {% if hash_check == 'show opt out' %}
                                                <div class="button-wrapper">
                                                    <input type="button" style="background-color: #6689a1;" value="{{ _("Abbrechen: Rechnung per Post", language) }}" onclick="opt_out('{{ digitalrechnung }}');">
                                                    <input type="button" id="changeEmailButton" style="background-color: #6689a1;display:none;" value="E-Mail-Adresse anpassen" onclick="change_email('{{ digitalrechnung }}');" disabled>
                                                    <input type="button" id="okButton" value="OK"  onclick="location.reload();">
                                                </div>
                                                {% endif %}
                                                {% if hash_check == 'show opt out bestätigung' %}
                                                <div class="button-wrapper">
                                                    <input type="button"  style="background-color: #6689a1;"  value="{{ _("Digitale Rechnung aktivieren", language) }}" onclick="location.reload();">
                                                    <input type="button" value="OK"  onclick="alert('{{ _("Ihr Wunsch (Papierrechnung) ist festgehalten.", language) }}')">
                                                </div>
                                                {% endif %}
                                                {% endif %}
                                            </fieldset>
                                        </form>
                                    </div>
                                </div>
                                <div class="content-info e-copy-small" role="contentinfo">
                                    <a class="link-top e-link-default" href="#content" title="Zum Seitenanfang">
                                        <i id="SeitenanfangChevron" class="fa fa-chevron-up"></i>Zum Seitenanfang
                                    </a>
                                    <a class="fa fa-print fa-pull-right" href="#" onclick="javascript:window.print();event.preventDefault();"></a>
                                </div>
                            </main>
                        </div>
                    </div>
                </div>
            </div>
            <footer class="footer" role="footer">
                <section class="footer-top">
                    <div class="container-inner">
                        <div class="row">
                            <div class="col-sm-12 col-md-6 col-lg-4 box-facebook">
                                <h3 class="channel-title">
                                    <a href="https://www.facebook.com/Mieterverband/" target="_blank">
                                        <i class="fa fa-facebook-official"></i><span>Facebook</span>
                                    </a>
                                </h3>
                                <h3 class="channel-title">
                                    <a href="https://twitter.com/Mieterverband" target="_blank">
                                        <i class="fa fa-twitter"></i><span>Twitter</span>
                                    </a>
                                </h3>
                            </div>
                            <div class="col-sm-12 col-md-6 col-lg-8 box-newsletter">
                                <h3 class="channel-title">
                                    <i class="fa fa-envelope-o"></i><span>Newsletter</span>
                                </h3>
                                <p class="newsletter-description">Abonnieren Sie unseren Newsletter und erfahren Sie immer das Neuste zu Mietrecht und Wohnpolitik in Ihrer Region sowie hilfreiche Tipps zu Mieten und Wohnen aus erster Hand.</p>
                                <div class="row">
                                    <div class="col-sm-12 col-md-12 col-lg-6">
                                        <a href="https://mieterverband.ch/mv/prozesse/newsletter.html" class="newsletter-link">Newsletter abonnieren</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <section class="footer-bottom">
                    <div class="container-inner">
                        <span class="copyright">© 2024 Mieterinnen- und Mieterverband</span>
                        <ul>
                            <li>
                                <a href="https://mieterverband.ch/mv/mitgliedschaft-verband/impressum.html">Impressum</a>
                            </li>
                            <li>
                                <a href="https://mieterverband.ch/mv/mitgliedschaft-verband/datenschutz.html">Datenschutz</a>
                            </li>
                            <li>
                                <a href="https://mieterverband.ch/mv/politik-positionen/medien.html">Medien</a>
                            </li>
                        </ul>
                    </div>
                </section>
            </footer>
        </div>
        {% block base_scripts %}
        <!-- js should be loaded in body! -->
        <script type="text/javascript" src="/assets/frappe/js/lib/jquery/jquery.min.js"></script>
        <script type="text/javascript" src="/assets/js/frappe-web.min.js"></script>
        <script type="text/javascript" src="/assets/js/bootstrap-4-web.min.js"></script>
        {% endblock %}
        <!-- csrf_token -->
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                var emailInput = document.getElementById('email');
                var emailHint = document.getElementById('emailHint');
                var changeEmailButton = document.getElementById('changeEmailButton');
                var okButton = document.getElementById('okButton');
                var addEmailButton = document.getElementById('addEmailButton');
                var originalEmail = emailInput.value;
        
                emailInput.addEventListener('input', function() {
                    var email = emailInput.value;
                    var isValid = isValidEmail(email);
                    var isChanged = email !== originalEmail;
        
                    if (email && isValid && isChanged) {
                        emailHint.textContent = ' ';
                        emailHint.style.color = '';
                        if (changeEmailButton) {
                            changeEmailButton.disabled = false;
                            changeEmailButton.style.backgroundColor = '#003A62'; // Original color when enabled
                            changeEmailButton.style.display = 'inline';
                        }
                        if (okButton) {
                            okButton.disabled = true;
                            okButton.style.display = 'none';
                            okButton.style.backgroundColor = '#ccd8e0'; // Disabled color
                            }
                        if (addEmailButton) {
                            addEmailButton.style.backgroundColor =  '#003A62';
                            addEmailButton.disabled = false;
                        }

                    } else {
                        if (!isValid) {
                            emailHint.textContent = '{{ _("Bitte geben Sie eine gültige E-Mail-Adresse ein.", language) }}';
                            emailHint.style.color = 'red';
                            if (changeEmailButton) {
                                changeEmailButton.disabled = true;
                                changeEmailButton.style.backgroundColor = '#ccd8e0'; // Disabled color  
                            }
                            if (okButton) {
                            okButton.disabled = true;
                            okButton.style.display = 'none';
                            }
                        } else {
                            emailHint.textContent = ' ';
                            emailHint.style.color = '';
                        }
                        if (changeEmailButton) {
                            changeEmailButton.disabled = true;
                            changeEmailButton.style.display = 'none';
                            changeEmailButton.style.backgroundColor = '#ccd8e0'; // Disabled color
                        }
                        if (okButton) {
                        okButton.disabled = false;
                        okButton.style.display = 'inline';
                        okButton.style.backgroundColor = '#6689a1'; // Original color when enabled
                        }
                    }
                });
            });
        
            function isValidEmail(email) {
                // Comprehensive email validation regex pattern
                var emailPattern = /^(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9]))\.){3}(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9])|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/;
                return emailPattern.test(email);
            }
        </script>
    </body>
</html>
